var t={width:1.5,height:1.5,depth:10,segments:12,slices:6,xRange:0.8,yRange:0.1,zRange:1,ambient:"#525252",diffuse:"#FFFFFF",speed:0.0002};var G={count:2,xyScalar:1,zOffset:100,ambient:"#002c4a",diffuse:"#005584",speed:0.001,gravity:1200,dampening:0.95,minLimit:10,maxLimit:null,minDistance:20,maxDistance:400,autopilot:false,draw:false,bounds:CAV.Vector3.create(),step:CAV.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1))};var canvas="canvas";var svg="svg";var configRenderer={renderer:canvas};var timeDelta,timeStart=Date.now();var L=CAV.Vector3.create();var k=CAV.Vector3.create();var $container=document.getElementById("container");var $anitOut=document.getElementById("anitOut");var $canvas,scene,mesh,plane,material;var canvasRenderer;function create(){createRenderer();createScene();setupScene();setupLight();resize($container.scrollWidth,$container.scrollHeight);handleResize();update()}function createRenderer(){canvasRenderer=new CAV.CanvasRenderer();createRendererElement(configRenderer.renderer)}function createRendererElement(a){if($canvas){$anitOut.removeChild($canvas.element)}switch(a){case canvas:$canvas=canvasRenderer;break}$canvas.setSize($container.scrollWidth,$container.offsetHeight);$anitOut.appendChild($canvas.element)}function createScene(){scene=new CAV.Scene()}function setupScene(){scene.remove(mesh);$canvas.clear();plane=new CAV.Plane(t.width*$canvas.width,t.height*$canvas.height,t.segments,t.slices);material=new CAV.Material(t.ambient,t.diffuse);mesh=new CAV.Mesh(plane,material);scene.add(mesh);var a,b;for(a=plane.vertices.length-1;a>=0;a--){b=plane.vertices[a];b.anchor=CAV.Vector3.clone(b.position);b.step=CAV.Vector3.create(Math.randomInRange(0.2,1),Math.randomInRange(0.2,1),Math.randomInRange(0.2,1));b.time=Math.randomInRange(0,Math.PIM2)}}function setupLight(){var b,a;for(b=scene.lights.length-1;b>=0;b--){a=scene.lights[b];scene.remove(a)}$canvas.clear();for(b=0;b<G.count;b++){a=new CAV.Light(G.ambient,G.diffuse);a.ambientHex=a.ambient.format();a.diffuseHex=a.diffuse.format();scene.add(a);a.mass=Math.randomInRange(0.5,1);a.velocity=CAV.Vector3.create();a.acceleration=CAV.Vector3.create();a.force=CAV.Vector3.create()}}function resize(b,a){$canvas.setSize(b,a);CAV.Vector3.set(L,$canvas.halfWidth,$canvas.halfHeight);setupScene()}function update(){timeDelta=Date.now()-timeStart;updateScene();renderScene();requestAnimationFrame(update)}function updateScene(){var g,h,i,f,e,b,c,d=t.depth/2;CAV.Vector3.copy(G.bounds,L);CAV.Vector3.multiplyScalar(G.bounds,G.xyScalar);CAV.Vector3.setZ(k,G.zOffset);for(f=scene.lights.length-1;f>=0;f--){e=scene.lights[f];CAV.Vector3.setZ(e.position,G.zOffset);var j=Math.clamp(CAV.Vector3.distanceSquared(e.position,k),G.minDistance,G.maxDistance);var a=G.gravity*e.mass/j;CAV.Vector3.subtractVectors(e.force,k,e.position);CAV.Vector3.normalise(e.force);CAV.Vector3.multiplyScalar(e.force,a);CAV.Vector3.set(e.acceleration);CAV.Vector3.add(e.acceleration,e.force);CAV.Vector3.add(e.velocity,e.acceleration);CAV.Vector3.multiplyScalar(e.velocity,G.dampening);CAV.Vector3.limit(e.velocity,G.minLimit,G.maxLimit);CAV.Vector3.add(e.position,e.velocity)}for(b=plane.vertices.length-1;b>=0;b--){c=plane.vertices[b];g=Math.sin(c.time+c.step[0]*timeDelta*t.speed);h=Math.cos(c.time+c.step[1]*timeDelta*t.speed);i=Math.sin(c.time+c.step[2]*timeDelta*t.speed);CAV.Vector3.set(c.position,t.xRange*plane.segmentWidth*g,t.yRange*plane.sliceHeight*h,t.zRange*d*i-d);CAV.Vector3.add(c.position,c.anchor)}plane.dirty=true}function renderScene(){$canvas.render(scene)}function setColors(c){var e,b,a=c;var d=function(g){for(e=0,l=scene.lights.length;e<l;e++){b=scene.lights[e];b.ambient.set(g);b.ambientHex=b.ambient.format()}};var f=function(g){for(e=0,l=scene.lights.length;e<l;e++){b=scene.lights[e];b.diffuse.set(g);b.diffuseHex=b.diffuse.format()}};return{set:function(){d(a[0]);f(a[1])}}}function handleResize(){window.addEventListener("resize",onResize);window.addEventListener("load",onResize);window.addEventListener("change",onResize)}function A(a){CAV.Vector3.set(k,a.x,$canvas.height-a.y);CAV.Vector3.subtract(k,L)}function onResize(a){console.log("resize");resize($container.scrollWidth,$container.scrollHeight);renderScene()}create();var colorTable=[["#002c4a","#005584"],["#35ac03","#3f4303"],["#ac0908","#cd5726"],["18bbff","#00486b"]];function changeColor(){setColors(colorTable[2]).set()};